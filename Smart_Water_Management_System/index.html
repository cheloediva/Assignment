<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Water Management System</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Smart Water Management System</h1>
        <nav>
            <ul class="nav-links">
                <li><a href="#dashboard">Dashboard</a></li>
                <li><a href="#manage-sensors">Manage Sensors</a></li>
                <li><a href="#leak-alerts">Leak Alerts</a></li>
                <li><a href="#water-logs">Water Logs</a></li>
                <li><a href="#create-user">Create User</a></li>
                <li><a href="admin_login.php">Admin Login</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <!-- Dashboard Section -->
        <section id="dashboard">
            <h2>Dashboard</h2>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>Total Sensors</h3>
                    <p id="total-sensors">Loading...</p>
                </div>
                <div class="card">
                    <h3>Active Alerts</h3>
                    <p id="active-alerts">Loading...</p>
                </div>
            </div>
        </section>

        <!-- Manage Sensors Section -->
        <section id="manage-sensors">
            <h2>Manage Sensors</h2>
            <form id="add-sensor-form">
                <input type="text" name="location" placeholder="Sensor Location" required>
                <input type="text" name="type" placeholder="Sensor Type" required>
                <button type="submit">Add Sensor</button>
            </form>
            <table>
                <thead>
                    <tr>
                        <th>Sensor ID</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Type</th>
                    </tr>
                </thead>
                <tbody id="sensor-table">
                    <!-- Sensor Data Will Load Dynamically -->
                </tbody>
            </table>
        </section>

        <!-- Leak Alerts Section -->
        <section id="leak-alerts">
            <h2>Leak Alerts</h2>
            <table>
                <thead>
                    <tr>
                        <th>Alert ID</th>
                        <th>Sensor ID</th>
                        <th>Timestamp</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="alerts-table">
                    <!-- Leak Alerts Will Load Dynamically -->
                </tbody>
            </table>
        </section>

        <!-- Water Logs Section -->
        <section id="water-logs">
            <h2>Water Usage Logs</h2>
            <table>
                <thead>
                    <tr>
                        <th>Log ID</th>
                        <th>Sensor ID</th>
                        <th>Timestamp</th>
                        <th>Flow Rate</th>
                    </tr>
                </thead>
                <tbody id="logs-table">
                    <!-- Water Logs Will Load Dynamically -->
                </tbody>
            </table>
        </section>

        <!-- Create User Section -->
        <section id="create-user">
            <h2>Create New User</h2>
            <form id="create-user-form">
                <input type="text" name="name" placeholder="Full Name" required>
                <input type="email" name="email" placeholder="Email Address" required>
                <input type="password" name="password" placeholder="Password" required>
                <button type="submit">Create User</button>
            </form>
        </section>
    </main>

    <footer>
        <p>&copy; 2024 Smart Water Management System</p>
    </footer>

    <script>
        // Dynamic Data Loading for Dashboard
        document.addEventListener('DOMContentLoaded', () => {
            loadDashboard();
            loadSensors();
            loadAlerts();
            loadLogs();

            document.getElementById('add-sensor-form').addEventListener('submit', async function(event) {
                event.preventDefault();
                const formData = new FormData(this);
                const response = await fetch('add_sensor.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                alert(result.message);
                if (result.status === 'success') {
                    loadSensors();
                }
            });

            document.getElementById('create-user-form').addEventListener('submit', async function(event) {
                event.preventDefault();
                const formData = new FormData(this);
                const response = await fetch('create_user.php', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();
                alert(result.message);
            });
        });

        async function loadDashboard() {
            const response = await fetch('get_dashboard_data.php');
            const data = await response.json();

            document.getElementById('total-sensors').innerText = data.total_sensors;
            document.getElementById('active-alerts').innerText = data.active_alerts;
        }

        async function loadSensors() {
            const response = await fetch('get_sensors.php');
            const sensors = await response.json();
            const sensorTable = document.querySelector('#sensor-table');
            sensorTable.innerHTML = '';

            sensors.forEach(sensor => {
                sensorTable.innerHTML += `<tr>
                    <td>${sensor.sensor_id}</td>
                    <td>${sensor.location}</td>
                    <td>${sensor.status}</td>
                    <td>${sensor.type}</td>
                </tr>`;
            });
        }

        async function loadAlerts() {
            const response = await fetch('get_alerts.php');
            const alerts = await response.json();
            const alertTable = document.querySelector('#alerts-table');
            alertTable.innerHTML = '';

            alerts.forEach(alert => {
                alertTable.innerHTML += `<tr>
                    <td>${alert.alert_id}</td>
                    <td>${alert.sensor_id}</td>
                    <td>${alert.timestamp}</td>
                    <td>${alert.status}</td>
                </tr>`;
            });
        }

        async function loadLogs() {
            const response = await fetch('get_water_logs.php');
            const logs = await response.json();
            const logsTable = document.querySelector('#logs-table');
            logsTable.innerHTML = '';

            logs.forEach(log => {
                logsTable.innerHTML += `<tr>
                    <td>${log.log_id}</td>
                    <td>${log.sensor_id}</td>
                    <td>${log.timestamp}</td>
                    <td>${log.flow_rate}</td>
                </tr>`;
            });
        }
    </script>
</body>
</html>
